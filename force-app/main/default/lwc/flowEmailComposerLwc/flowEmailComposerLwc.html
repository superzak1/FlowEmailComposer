<template>
  <div class="slds-box" style="background: white">
    <lightning-layout multiple-rows>
      <lightning-layout-item size="12" class="slds-p-horizontal_small">
        <lightning-input
          value={toAddresses}
          required="true"
          label="To:Specify comma separated e-mail addresses"
        ></lightning-input>
      </lightning-layout-item>

      <template if:true={showCCButton}>
        <lightning-layout-item size="1" class="slds-p-horizontal_small">
          <lightning-button
            variant="base"
            label="CC"
            onclick={showcc}
          ></lightning-button>
        </lightning-layout-item>
      </template>
      <template if:true={showBCCButton}>
        <lightning-layout-item size="1" class="slds-p-horizontal_small">
          <lightning-button
            variant="base"
            label="Bcc"
            onclick={showbcc}
          ></lightning-button>
        </lightning-layout-item>
      </template>
      <template if:true={showCCFieldFinal}>
        <lightning-layout-item size="12" class="slds-p-horizontal_small">
          <lightning-input
            value={ccAddresses}
            required="true"
            label="CC: Specify comma separated e-mail addresses"
          ></lightning-input>
        </lightning-layout-item>
      </template>
      <template if:true={showBCCFieldFinal}>
        <lightning-layout-item size="12" class="slds-p-horizontal_small">
          <lightning-input
            value={bccAddresses}
            label="Bcc: Specify comma separated e-mail addresses"
            required="true"
          ></lightning-input>
        </lightning-layout-item>
      </template>
      <lightning-layout-item size="12" class="slds-p-horizontal_small">
        <lightning-input
          name="subject"
          label="Subject"
          value={subject}
          required="true"
        ></lightning-input>
      </lightning-layout-item>

      <template if:false={hideTemplateSelection}>
        <lightning-layout-item size="12" class="slds-p-horizontal_small">
          <lightning-combobox
            options={folders}
            name="template"
            label="Select Email Template Folder:"
            value={selFolderId}
            onchange={filterEmailTemplates}
          >
          </lightning-combobox>
        </lightning-layout-item>
        <lightning-layout-item size="12" class="slds-p-horizontal_small">
          <lightning-combobox
            name="template"
            label="Select a Template:"
            value={selTemplateId}
            onchange={changeBody}
            options={filteredTemplateList}
          >
          </lightning-combobox>
        </lightning-layout-item>
      </template>

      <lightning-layout-item size="12" class="slds-p-horizontal_small">
        <label class="slds-form-element__label"
          ><abbr class="slds-required" title="required">* </abbr>Body
        </label>
        <lightning-input-rich-text
          label="Body"
          value={emailBody}
        ></lightning-input-rich-text>
      </lightning-layout-item>
      <template if:true={hasTemplateAttachments}>
        <lightning-layout-item size="12" class="slds-p-horizontal_small">
          <label class="slds-form-element__label"
            >Attached Files from Template:</label
          >
          <template for:each={attachmentsFromTemplate} for:item="att">
            <lightning-pill
              key={att.attachId}
              class="pillcss"
              name={att.attachId}
              label={att.fileName}
              onremove={att.removeAtt}
            ></lightning-pill>
          </template>
        </lightning-layout-item>
      </template>
      <lightning-layout-item size="12" class="slds-p-horizontal_small">
        <label class="slds-form-element__label">Attach New Files:</label>
        <lightning-file-upload
          label=""
          multiple="true"
          record-id={uploadRefId}
          onuploadfinished={uploadFinished}
        ></lightning-file-upload>
      </lightning-layout-item>
      <lightning-layout-item size="12" class="slds-p-horizontal_small">
        <template for:each={filesTobeAttached} for:item="f">
          <lightning-pill
            key={f.name}
            class="pillcss"
            name={f.documentId}
            label={f.name}
            onremove={delFiles}
            onclick={previewFile}
          ></lightning-pill>
        </template>
        <template if:true={showSpinner}>
          <lightning-spinner
            alternative-text="Loading"
            size="medium"
          ></lightning-spinner>
        </template>
      </lightning-layout-item>
      <template if:true={showSendButton}>
        <lightning-layout-item size="12" class="slds-p-around_small">
          <lightning-button
            disabled={sendButtonDisabled}
            class="slds-align_absolute-center"
            variant="brand"
            label="Send"
            onclick={sendEmail}
          ></lightning-button>
        </lightning-layout-item>
      </template>
    </lightning-layout>
  </div>

  <!-- File Preview -->
  <!--
    <template if:true={hasModalOpen}>
        <section onclick={closeModal}
                 role="dialog"
                 aria-modal="true"
                 class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <div class="slds-modal__content slds-p-around_medium slds-text-align_center"
                     style="background: transparent;">
                    <div style="width: 50%; margin: 0 auto; text-align: left">
                        <lightning:fileCard fileId="{!v.selectedDocumentId}"/>
                    </div>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>
-->
</template>
